// Copyright (c) Six Labors and contributors.
// Licensed under the Apache License, Version 2.0.

using System.Collections.Generic;

namespace SixLabors.ImageSharp.Formats.WebP
{
    /// <summary>
    /// Constants used for decoding VP8 and VP8L bitstreams.
    /// </summary>
    internal static class WebPConstants
    {
        /// <summary>
        /// The list of file extensions that equate to WebP.
        /// </summary>
        public static readonly IEnumerable<string> FileExtensions = new[] { "webp" };

        /// <summary>
        /// The list of mimetypes that equate to a jpeg.
        /// </summary>
        public static readonly IEnumerable<string> MimeTypes = new[] { "image/webp", };

        /// <summary>
        /// Signature which identifies a VP8 header.
        /// </summary>
        public static readonly byte[] Vp8MagicBytes =
        {
            0x9D,
            0x01,
            0x2A
        };

        /// <summary>
        /// The header bytes identifying RIFF file.
        /// </summary>
        public static readonly byte[] RiffFourCc =
        {
            0x52, // R
            0x49, // I
            0x46, // F
            0x46 // F
        };

        /// <summary>
        /// The header bytes identifying a WebP.
        /// </summary>
        public static readonly byte[] WebPHeader =
        {
            0x57, // W
            0x45, // E
            0x42, // B
            0x50 // P
        };

        /// <summary>
        /// Signature byte which identifies a VP8L header.
        /// </summary>
        public const byte Vp8LMagicByte = 0x2F;

        /// <summary>
        /// 3 bits reserved for version.
        /// </summary>
        public const int Vp8LVersionBits = 3;

        /// <summary>
        /// Bits for width and height infos of a VPL8 image.
        /// </summary>
        public const int Vp8LImageSizeBits = 14;

        /// <summary>
        /// Maximum number of color cache bits.
        /// </summary>
        public const int MaxColorCacheBits = 11;

        /// <summary>
        /// The maximum number of allowed transforms in a VP8L bitstream.
        /// </summary>
        public const int MaxNumberOfTransforms = 4;

        public const int MaxAllowedCodeLength = 15;

        public const int DefaultCodeLength = 8;

        public const int HuffmanCodesPerMetaCode = 5;

        public const uint ArgbBlack = 0xff000000;

        public const int NumLiteralCodes = 256;

        public const int NumLengthCodes = 24;

        public const int NumDistanceCodes = 40;

        public const int LengthTableBits = 7;

        public const uint CodeLengthLiterals = 16;

        public const int CodeLengthRepeatCode = 16;

        public static readonly int[] CodeLengthExtraBits = { 2, 3, 7 };

        public static readonly int[] CodeLengthRepeatOffsets = { 3, 3, 11 };

        public static readonly int[] AlphabetSize =
        {
                                                         NumLiteralCodes + NumLengthCodes,
                                                         NumLiteralCodes, NumLiteralCodes, NumLiteralCodes,
                                                         NumDistanceCodes
        };

        // VP8 constants from here on
        public const int NumMbSegments = 4;

        public const int MaxNumPartitions = 8;

        public const int NumTypes = 4;

        public const int NumBands = 8;

        public const int NumProbas = 11;

        public const int NumCtx = 3;

        // Paragraph 9.9
        public static readonly int[] Bands =
        {
            0, 1, 2, 3, 6, 4, 5, 6, 6, 6, 6, 6, 6, 6, 6, 7, 0
        };

        // Paragraph 14.1
        public static readonly int[] DcTable =
        {
            4,     5,   6,   7,   8,   9,  10,  10,
            11,   12,  13,  14,  15,  16,  17,  17,
            18,   19,  20,  20,  21,  21,  22,  22,
            23,   23,  24,  25,  25,  26,  27,  28,
            29,   30,  31,  32,  33,  34,  35,  36,
            37,   37,  38,  39,  40,  41,  42,  43,
            44,   45,  46,  46,  47,  48,  49,  50,
            51,   52,  53,  54,  55,  56,  57,  58,
            59,   60,  61,  62,  63,  64,  65,  66,
            67,   68,  69,  70,  71,  72,  73,  74,
            75,   76,  76,  77,  78,  79,  80,  81,
            82,   83,  84,  85,  86,  87,  88,  89,
            91,   93,  95,  96,  98, 100, 101, 102,
            104, 106, 108, 110, 112, 114, 116, 118,
            122, 124, 126, 128, 130, 132, 134, 136,
            138, 140, 143, 145, 148, 151, 154, 157
        };

        // Paragraph 14.1
        public static readonly int[] AcTable =
        {
            4,     5,   6,   7,   8,   9,  10,  11,
            12,   13,  14,  15,  16,  17,  18,  19,
            20,   21,  22,  23,  24,  25,  26,  27,
            28,   29,  30,  31,  32,  33,  34,  35,
            36,   37,  38,  39,  40,  41,  42,  43,
            44,   45,  46,  47,  48,  49,  50,  51,
            52,   53,  54,  55,  56,  57,  58,  60,
            62,   64,  66,  68,  70,  72,  74,  76,
            78,   80,  82,  84,  86,  88,  90,  92,
            94,   96,  98, 100, 102, 104, 106, 108,
            110, 112, 114, 116, 119, 122, 125, 128,
            131, 134, 137, 140, 143, 146, 149, 152,
            155, 158, 161, 164, 167, 170, 173, 177,
            181, 185, 189, 193, 197, 201, 205, 209,
            213, 217, 221, 225, 229, 234, 239, 245,
            249, 254, 259, 264, 269, 274, 279, 284
        };

        // Paragraph 13
        public static readonly byte[,,,] CoeffsUpdateProba =
        {
          { { { 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
              { 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
              { 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255 }
            },
            { { 176, 246, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
              { 223, 241, 252, 255, 255, 255, 255, 255, 255, 255, 255 },
              { 249, 253, 253, 255, 255, 255, 255, 255, 255, 255, 255 }
            },
            { { 255, 244, 252, 255, 255, 255, 255, 255, 255, 255, 255 },
              { 234, 254, 254, 255, 255, 255, 255, 255, 255, 255, 255 },
              { 253, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255 }
            },
            { { 255, 246, 254, 255, 255, 255, 255, 255, 255, 255, 255 },
              { 239, 253, 254, 255, 255, 255, 255, 255, 255, 255, 255 },
              { 254, 255, 254, 255, 255, 255, 255, 255, 255, 255, 255 }
            },
            { { 255, 248, 254, 255, 255, 255, 255, 255, 255, 255, 255 },
              { 251, 255, 254, 255, 255, 255, 255, 255, 255, 255, 255 },
              { 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255 }
            },
            { { 255, 253, 254, 255, 255, 255, 255, 255, 255, 255, 255 },
              { 251, 254, 254, 255, 255, 255, 255, 255, 255, 255, 255 },
              { 254, 255, 254, 255, 255, 255, 255, 255, 255, 255, 255 }
            },
            { { 255, 254, 253, 255, 254, 255, 255, 255, 255, 255, 255 },
              { 250, 255, 254, 255, 254, 255, 255, 255, 255, 255, 255 },
              { 254, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255 }
            },
            { { 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
              { 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
              { 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255 }
            }
          },
          { { { 217, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
              { 225, 252, 241, 253, 255, 255, 254, 255, 255, 255, 255 },
              { 234, 250, 241, 250, 253, 255, 253, 254, 255, 255, 255 }
            },
            { { 255, 254, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
              { 223, 254, 254, 255, 255, 255, 255, 255, 255, 255, 255 },
              { 238, 253, 254, 254, 255, 255, 255, 255, 255, 255, 255 }
            },
            { { 255, 248, 254, 255, 255, 255, 255, 255, 255, 255, 255 },
              { 249, 254, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
              { 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255 }
            },
            { { 255, 253, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
              { 247, 254, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
              { 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255 }
            },
            { { 255, 253, 254, 255, 255, 255, 255, 255, 255, 255, 255 },
              { 252, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
              { 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255 }
            },
            { { 255, 254, 254, 255, 255, 255, 255, 255, 255, 255, 255 },
              { 253, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
              { 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255 }
            },
            { { 255, 254, 253, 255, 255, 255, 255, 255, 255, 255, 255 },
              { 250, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
              { 254, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255 }
            },
            { { 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
              { 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
              { 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255 }
            }
          },
          { { { 186, 251, 250, 255, 255, 255, 255, 255, 255, 255, 255 },
              { 234, 251, 244, 254, 255, 255, 255, 255, 255, 255, 255 },
              { 251, 251, 243, 253, 254, 255, 254, 255, 255, 255, 255 }
            },
            { { 255, 253, 254, 255, 255, 255, 255, 255, 255, 255, 255 },
              { 236, 253, 254, 255, 255, 255, 255, 255, 255, 255, 255 },
              { 251, 253, 253, 254, 254, 255, 255, 255, 255, 255, 255 }
            },
            { { 255, 254, 254, 255, 255, 255, 255, 255, 255, 255, 255 },
              { 254, 254, 254, 255, 255, 255, 255, 255, 255, 255, 255 },
              { 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255 }
            },
            { { 255, 254, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
              { 254, 254, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
              { 254, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255 }
            },
            { { 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
              { 254, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
              { 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255 }
            },
            { { 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
              { 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
              { 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255 }
            },
            { { 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
              { 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
              { 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255 }
            },
            { { 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
              { 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
              { 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255 }
            }
          },
          { { { 248, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
              { 250, 254, 252, 254, 255, 255, 255, 255, 255, 255, 255 },
              { 248, 254, 249, 253, 255, 255, 255, 255, 255, 255, 255 }
            },
            { { 255, 253, 253, 255, 255, 255, 255, 255, 255, 255, 255 },
              { 246, 253, 253, 255, 255, 255, 255, 255, 255, 255, 255 },
              { 252, 254, 251, 254, 254, 255, 255, 255, 255, 255, 255 }
            },
            { { 255, 254, 252, 255, 255, 255, 255, 255, 255, 255, 255 },
              { 248, 254, 253, 255, 255, 255, 255, 255, 255, 255, 255 },
              { 253, 255, 254, 254, 255, 255, 255, 255, 255, 255, 255 }
            },
            { { 255, 251, 254, 255, 255, 255, 255, 255, 255, 255, 255 },
              { 245, 251, 254, 255, 255, 255, 255, 255, 255, 255, 255 },
              { 253, 253, 254, 255, 255, 255, 255, 255, 255, 255, 255 }
            },
            { { 255, 251, 253, 255, 255, 255, 255, 255, 255, 255, 255 },
              { 252, 253, 254, 255, 255, 255, 255, 255, 255, 255, 255 },
              { 255, 254, 255, 255, 255, 255, 255, 255, 255, 255, 255 }
            },
            { { 255, 252, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
              { 249, 255, 254, 255, 255, 255, 255, 255, 255, 255, 255 },
              { 255, 255, 254, 255, 255, 255, 255, 255, 255, 255, 255 }
            },
            { { 255, 255, 253, 255, 255, 255, 255, 255, 255, 255, 255 },
              { 250, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
              { 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255 }
            },
            { { 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
              { 254, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
              { 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255 }
            }
          }
        };

        // Paragraph 13.5: Default Token Probability Table.
        public static readonly byte[,,,] DefaultCoeffsProba =
        {
          {
            { { 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128 },
              { 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128 },
              { 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128 }
            },
            { { 253, 136, 254, 255, 228, 219, 128, 128, 128, 128, 128 },
              { 189, 129, 242, 255, 227, 213, 255, 219, 128, 128, 128 },
              { 106, 126, 227, 252, 214, 209, 255, 255, 128, 128, 128 }
            },
            { { 1, 98, 248, 255, 236, 226, 255, 255, 128, 128, 128 },
              { 181, 133, 238, 254, 221, 234, 255, 154, 128, 128, 128 },
              { 78, 134, 202, 247, 198, 180, 255, 219, 128, 128, 128 },
            },
            { { 1, 185, 249, 255, 243, 255, 128, 128, 128, 128, 128 },
              { 184, 150, 247, 255, 236, 224, 128, 128, 128, 128, 128 },
              { 77, 110, 216, 255, 236, 230, 128, 128, 128, 128, 128 },
            },
            { { 1, 101, 251, 255, 241, 255, 128, 128, 128, 128, 128 },
              { 170, 139, 241, 252, 236, 209, 255, 255, 128, 128, 128 },
              { 37, 116, 196, 243, 228, 255, 255, 255, 128, 128, 128 }
            },
            { { 1, 204, 254, 255, 245, 255, 128, 128, 128, 128, 128 },
              { 207, 160, 250, 255, 238, 128, 128, 128, 128, 128, 128 },
              { 102, 103, 231, 255, 211, 171, 128, 128, 128, 128, 128 }
            },
            { { 1, 152, 252, 255, 240, 255, 128, 128, 128, 128, 128 },
              { 177, 135, 243, 255, 234, 225, 128, 128, 128, 128, 128 },
              { 80, 129, 211, 255, 194, 224, 128, 128, 128, 128, 128 }
            },
            { { 1, 1, 255, 128, 128, 128, 128, 128, 128, 128, 128 },
              { 246, 1, 255, 128, 128, 128, 128, 128, 128, 128, 128 },
              { 255, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128 }
            }
          },
          {
            { { 198, 35, 237, 223, 193, 187, 162, 160, 145, 155, 62 },
              { 131, 45, 198, 221, 172, 176, 220, 157, 252, 221, 1 },
              { 68, 47, 146, 208, 149, 167, 221, 162, 255, 223, 128 }
            },
            { { 1, 149, 241, 255, 221, 224, 255, 255, 128, 128, 128 },
              { 184, 141, 234, 253, 222, 220, 255, 199, 128, 128, 128 },
              { 81, 99, 181, 242, 176, 190, 249, 202, 255, 255, 128 }
            },
            { { 1, 129, 232, 253, 214, 197, 242, 196, 255, 255, 128 },
              { 99, 121, 210, 250, 201, 198, 255, 202, 128, 128, 128 },
              { 23, 91, 163, 242, 170, 187, 247, 210, 255, 255, 128 }
            },
            { { 1, 200, 246, 255, 234, 255, 128, 128, 128, 128, 128 },
              { 109, 178, 241, 255, 231, 245, 255, 255, 128, 128, 128 },
              { 44, 130, 201, 253, 205, 192, 255, 255, 128, 128, 128 }
            },
            { { 1, 132, 239, 251, 219, 209, 255, 165, 128, 128, 128 },
              { 94, 136, 225, 251, 218, 190, 255, 255, 128, 128, 128 },
              { 22, 100, 174, 245, 186, 161, 255, 199, 128, 128, 128 }
            },
            { { 1, 182, 249, 255, 232, 235, 128, 128, 128, 128, 128 },
              { 124, 143, 241, 255, 227, 234, 128, 128, 128, 128, 128 },
              { 35, 77, 181, 251, 193, 211, 255, 205, 128, 128, 128 }
            },
            { { 1, 157, 247, 255, 236, 231, 255, 255, 128, 128, 128 },
              { 121, 141, 235, 255, 225, 227, 255, 255, 128, 128, 128 },
              { 45, 99, 188, 251, 195, 217, 255, 224, 128, 128, 128 }
            },
            { { 1, 1, 251, 255, 213, 255, 128, 128, 128, 128, 128 },
              { 203, 1, 248, 255, 255, 128, 128, 128, 128, 128, 128 },
              { 137, 1, 177, 255, 224, 255, 128, 128, 128, 128, 128 }
            }
          },
          { { { 253, 9, 248, 251, 207, 208, 255, 192, 128, 128, 128 },
              { 175, 13, 224, 243, 193, 185, 249, 198, 255, 255, 128 },
              { 73, 17, 171, 221, 161, 179, 236, 167, 255, 234, 128 }
            },
            { { 1, 95, 247, 253, 212, 183, 255, 255, 128, 128, 128 },
              { 239, 90, 244, 250, 211, 209, 255, 255, 128, 128, 128 },
              { 155, 77, 195, 248, 188, 195, 255, 255, 128, 128, 128 }
            },
            { { 1, 24, 239, 251, 218, 219, 255, 205, 128, 128, 128 },
              { 201, 51, 219, 255, 196, 186, 128, 128, 128, 128, 128 },
              { 69, 46, 190, 239, 201, 218, 255, 228, 128, 128, 128 }
            },
            { { 1, 191, 251, 255, 255, 128, 128, 128, 128, 128, 128 },
              { 223, 165, 249, 255, 213, 255, 128, 128, 128, 128, 128 },
              { 141, 124, 248, 255, 255, 128, 128, 128, 128, 128, 128 }
            },
            { { 1, 16, 248, 255, 255, 128, 128, 128, 128, 128, 128 },
              { 190, 36, 230, 255, 236, 255, 128, 128, 128, 128, 128 },
              { 149, 1, 255, 128, 128, 128, 128, 128, 128, 128, 128 }
            },
            { { 1, 226, 255, 128, 128, 128, 128, 128, 128, 128, 128 },
              { 247, 192, 255, 128, 128, 128, 128, 128, 128, 128, 128 },
              { 240, 128, 255, 128, 128, 128, 128, 128, 128, 128, 128 }
            },
            { { 1, 134, 252, 255, 255, 128, 128, 128, 128, 128, 128 },
              { 213, 62, 250, 255, 255, 128, 128, 128, 128, 128, 128 },
              { 55, 93, 255, 128, 128, 128, 128, 128, 128, 128, 128 }
            },
            { { 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128 },
              { 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128 },
              { 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128 }
            }
          },
          {
            { { 202, 24, 213, 235, 186, 191, 220, 160, 240, 175, 255 },
              { 126, 38, 182, 232, 169, 184, 228, 174, 255, 187, 128 },
              { 61, 46, 138, 219, 151, 178, 240, 170, 255, 216, 128 }
            },
            { { 1, 112, 230, 250, 199, 191, 247, 159, 255, 255, 128 },
              { 166, 109, 228, 252, 211, 215, 255, 174, 128, 128, 128 },
              { 39, 77, 162, 232, 172, 180, 245, 178, 255, 255, 128 }
            },
            { { 1, 52, 220, 246, 198, 199, 249, 220, 255, 255, 128 },
              { 124, 74, 191, 243, 183, 193, 250, 221, 255, 255, 128 },
              { 24, 71, 130, 219, 154, 170, 243, 182, 255, 255, 128 }
            },
            { { 1, 182, 225, 249, 219, 240, 255, 224, 128, 128, 128 },
              { 149, 150, 226, 252, 216, 205, 255, 171, 128, 128, 128 },
              { 28, 108, 170, 242, 183, 194, 254, 223, 255, 255, 128 }
            },
            { { 1, 81, 230, 252, 204, 203, 255, 192, 128, 128, 128 },
              { 123, 102, 209, 247, 188, 196, 255, 233, 128, 128, 128 },
              { 20, 95, 153, 243, 164, 173, 255, 203, 128, 128, 128 }
            },
            { { 1, 222, 248, 255, 216, 213, 128, 128, 128, 128, 128 },
              { 168, 175, 246, 252, 235, 205, 255, 255, 128, 128, 128 },
              { 47, 116, 215, 255, 211, 212, 255, 255, 128, 128, 128 }
            },
            { { 1, 121, 236, 253, 212, 214, 255, 255, 128, 128, 128 },
              { 141, 84, 213, 252, 201, 202, 255, 219, 128, 128, 128 },
              { 42, 80, 160, 240, 162, 185, 255, 205, 128, 128, 128 }
            },
            { { 1, 1, 255, 128, 128, 128, 128, 128, 128, 128, 128 },
              { 244, 1, 255, 128, 128, 128, 128, 128, 128, 128, 128 },
              { 238, 1, 255, 128, 128, 128, 128, 128, 128, 128, 128 }
            }
          }
        };
    }
}
